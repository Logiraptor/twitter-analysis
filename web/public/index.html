<!DOCTYPE html>
<html>
  <head>
	<style type="text/css">
	  html, body { height: 100%; margin: 0; padding: 0; }
	  .content {margin-left: auto; margin-right: auto; width: 1000px;}
	  .map { width: 700px; height: 80%; display: inline-block;}
	  .map-wrapper {width: 100%; height: 400px; float: left;}
	  .summary-stats {width: 300px; height: 100%; display: inline-block; float: left;}
	</style>
  </head>
  <body>
	<div class="content">
		<h1>Bro / Bruh / Brah</h1>
		<div class="map-wrapper">
			<h2>Bruh</h2>
			<div class="map" id="bruh-map"></div>
			<div class="summary-stats" id="bruh-stats">
				<h4>Summary Stats</h4>
			</div>
		</div>
		<div class="map-wrapper">
			<h2>Bro</h2>
			<div class="map" id="bro-map"></div>
			<div class="summary-stats" id="bro-stats">
				<h4>Summary Stats</h4>
			</div>
		</div>
		<div class="map-wrapper">
			<h2>Brah</h2>
			<div class="map" id="brah-map"></div>
			<div class="summary-stats" id="brah-stats">
				<h4>Summary Stats</h4>
			</div>
		</div>
	</div>
	<script type="text/javascript">

		function initMaps() {
			var forms = ["bruh", "bro", "brah"];
			for (var i = forms.length - 1; i >= 0; i--) {
				var map;
				map = new google.maps.Map(document.getElementById(forms[i]+'-map'), {
					center: {lat: 39.5, lng: -98.35},
					zoom: 3
				});

				var stats = document.getElementById(forms[i]+'-stats');
				var refreshData = function(map, stats, form) {
					$.ajax({
						method: "GET",
						url: "/heatmap/"+form,
						dataType: "json",
						success: function(data) {
							stats.innerHTML += "N = " + data.n + "<br>";
							// stats.innerHTML += "Avg Length = " + data.avgLen + "<br>";
							var coords = data.coords;
							var heatData = [];
							for (var i = coords.length - 1; i >= 0; i--) {
								heatData.push(new google.maps.LatLng(coords[i].Coords[1], coords[i].Coords[0]));
							}
							var heatmap = new google.maps.visualization.HeatmapLayer({
							  data: heatData,
							  dissipating: true
							});
							heatmap.setMap(map);
						},
						error: function(data) {
							console.log(data);
						}
					});
				}.bind(undefined, map, stats, forms[i]);

				refreshData();
			};
		}

	</script>
	<script 
	  src="//code.jquery.com/jquery-1.11.3.min.js">
	</script>
	<script async defer
	  src="https://maps.googleapis.com/maps/api/js?key=AIzaSyA90Of7M7LqIJVI5Xa-vlqBGAyNvWfu3l4&callback=initMaps&libraries=visualization">
	</script>
  </body>
</html>